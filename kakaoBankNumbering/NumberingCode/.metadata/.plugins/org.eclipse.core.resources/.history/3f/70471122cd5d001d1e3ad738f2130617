<?xml version="1.0"?>

<project name = "Numbering" default="help" basedir=".">
	<target name="help">
		<echo message="Use ant -projecthelp for usage information." />
	</target>

	<!-- =================================================================== -->
	<!-- engine                                                                                                                                           -->
	<!-- =================================================================== -->
	<!-- engine init 단계 : 변수명 초기화 및 engine에 사용 될 클래스패스 설정 -->
	<target name="init.engine">
		<property name="engine-name" value="numberingEngine" />
		<property name="build.dir.engine" value="../build/${engine-name}" />
		<property name="dist.dir.engine" value="../dist/${engine-name}" />
		<property name="war-file-name" value="${engine-name}.war" />
		<property name="web-xml-file" value="../src/main/webapp/WEB-INF/web.xml" />
		<property name="classes-directory" value="../build/${engine-name}" />
		<property name= "war-lib-path" value = "../src/main/webapp/WEB-INF/lib"/>
		<property name="src.dir" value="../src/main/java" />
		<property name="lib.dir" value="../lib" />
		<property name="compile.debug" value="true" />
		<property name="compile.deprecation" value="false" />
		<property name="compile.optimize" value="true" />
		<property name="compile.encoding" value="euc-kr" />
		<path id="classpath.engine">
			<pathelement location="${lib.dir}/log4j-1.2.8.jar" />
			<pathelement location="${lib.dir}/servlet-api.jar" />
		</path>
	</target>

	<!-- engine compile 단계 : 엔진에 필요한 자바 파일들만 빌드 -->
	<target name="compile.engine" depends="init.engine">
		<mkdir dir="${build.dir.engine}" />
		<javac srcdir="${src.dir}" destdir="${build.dir.engine}" deprecation="${compile.deprecation}" debug="${compile.debug}" optimize="${compile.optimize}" encoding="${compile.encoding}">
			<include name="engine/*.java" />
			<include name="common/logging/*.java" />
			<classpath refid="classpath.engine" />
		</javac>
	</target>

	<!-- engine clean 단계 : 엔진에 생성되었던 war파일과 class파일들 제거 -->
	<target name="clean.engine"  depends="init.engine">
		<delete dir="${build.dir.engine}" />
		<delete dir="${dist.dir.engine}" />
	</target>

	<!-- distribute engine 단계 : war파일 배포 -->
	<target name="dist.engine"  depends="clean.engine, compile.engine">
		<mkdir dir="${dist.dir.engine}" />
		<war warfile="${dist.dir.engine}/${war-file-name}" webxml="${web-xml-file}"  >
			<classes dir="${classes-directory}"  />
			<lib dir = "${war-lib-path}}/*.jar"/>
			<manifest>
				<attribute name="Built-By" value="ChangHee_Kim" />
				<attribute name="Main-Class" value="engine.Version" />
				<attribute name="Sealed" value="false" />
			</manifest>
		</war>
	</target>
</project>
